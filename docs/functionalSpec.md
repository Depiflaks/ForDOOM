## Функционал. Спека
Здесь спецификация по функционалу

## User

#### Аутентификация
1) Регистрация (создать новый аккаунт в системе).
Обязательные поля:
- email
- password

**Поведение**
- Если пользователь с таким email уже существует, блокируем регистрацию, сообщаем об этом пользователю
- Если email не удовлетворяет regexp почты, то предупреждаем об этом пользователя
- Если всё успешно, то создаётся пользователь, его логинит и перекидывает на главную страницу
- По умолчанию никнейм пользователя - его почта до символа @. Если пользователь с таким никнеймом существует, прибавляет к нему числа: почта smmm@gmail.com, никнейм - smmm. Если пользователь smmm существует, то никнейм smmm1. Если пользователь smmm1 существует, никнейм - smmm2 и тд.

2) Логинация (вход в систему с существующим аккаунтом)
Обязательные поля:
- email
- password

**Поведение**
- Если аккаунт с таким логином или паролем не найден, то сообщаем об этом пользователю
- Если всё верно, сохраняется сессия и пользователя впускает на главный экран

**Требования**
1) В случае перезагрузки страницы сессия, должна сохраняться
2) В случае открытия и закрытия браузера, сессия должна сохраняться
3) В случае изменения ip пользователья, сессия не должна сохраняться

#### Аккаунт
1) Информация в профиле пользователя
- Никнейм
- Почта
- Аватарка
- Рейтинг
- Список тем, которые создал пользователь

#### Аккаунт владельца профиля
1) Та же информация, что в общем аккаунте
2) Сменить никнейм
**Поведение**
- Если пользователь с таким никнеймом существует, кидаем предупреждение об этом
*При этом никеймы не различаются по регистру, т.е. smmm и Smmm - одинаковые никнеймы*
3) Сменить пароль
Обязательные поля:
- старый пароль
- новый пароль
- подтверждение нового пароля (только на фронтенде)
**Поведение**
- Если старый пароль не совпадает, предупреждаем пользователя
- Если новый пароль совпадает со старым, предупреждаем об этом пользователя
- Иначе смена пароля происходит успешно
4) Удалить аккаунт
Вылезает окно с подтверждением того, что ты хочешь удалить аккаунт
**Поведение**
- Аватарка пользователя удаляется (заменяется)
- Аккаунт продолжает отображаться для других пользователей, но помечается, как удалённый
- Темы, созданные пользователем помечаются, как закрытые

5) Выйти из аккаунта
**Поведение**
- Сессия закрывается. При перезагрузке страницы пользователя перебросит на страницу логинации

**Требования**
1) При выполнении запросов раздела пользователь обязан быть владельцем аккаунта

#### Карма
Карма складывается из рейтинга:
1) Созданных пользователем тем
2) Отправленных пользователем сообщений под темами

**Требования**
1) Пользователь не может менять карму своих тем и сообщений
2) Синхронизация (общая карма пользователя) должна обновляться 2 раза в сутки либо по запросу

## Topic List

#### Расположение
1) Главной странице
2) Профиле пользователя

#### Фильтрация
1) По никнейму автора
2) По подстроке названия темы
3) По дате создания
4) По диапазону дат создания

**Требования**
1) Пустой фильтр = отсутствие фильтров

#### Сортировка
1) По дате создания
2) По дате последнего комментария
3) По дате последней реакции
4) По суммарному колличеству реакций
5) По названиям по алфавиту

**Требования**
1) Сортировка должна работать как по возрастанию, так по убыванию
1) Упорядочивание по алфавиту на фронтенде должно работать корректно
```
Тема 1
Тема 2
Тема 11
```
А не
```
Тема 1
Тема 11
Тема 2
```

# Темы. Черновик.
Сущности описаны в ER-диаграмме.

## Терминология.
- **Посетитель** --- человек, использующий сайт.
- **Гость** --- посетитель, который не прошёл аутентификацию.
- **Пользователь** --- посетитель, прошедший аутентификацию.

## Просмотр темы.
Посетители могут просматривать *все* темы на сайте.

### Frontend.
На странице темы отображаются сообщения. Порядок сообщений задан их номером в теме: чем больше номер сообщения, тем ниже оно в теме. Пагинация сообщений *отсутствует*.

Содержимое сообщения отображается на странице. У сообщения можно просмотреть его автора, время отправки и время последнего редактирования, если оно присутствует.

У сообщения есть строка реакций, в которой отображаются кнопки реакций (т.е. реакции, оставленные пользователями). Рядом с каждой кнопкой реакций отображается кол-во пользователей, которые оставили данную реакцию. Если посетитель аутентифицирован, то в конце строки реакций находится кнопка "+" для добавления новых реакций.

У сообщения есть блок кармы, в котором отображается карма сообщения и кнопки для голосования.

## Создание темы.
### Frontend.
TODO: мб вместо страницы создания использовать модальное окно?

Кнопка создания темы располагается на главной странице. Кнопка доступна только для пользователей. При нажатии на кнопку создания темы открывается страница, на которой находится:
1. Форма.
    1. Заголовок.
    2. Содержание первого сообщения в теме.
2. Кнопка "Создать".
3. Кнопка "Назад".

Кнопка "Назад" возвращает пользователя на главную страницу. При успешном создании темы пользователя перенаправляет на страницу только что созданной темы.

### Поведение.
Любой пользователь может создать тему на сайте. Для создания темы требуется заполнить оба поля в форме создания.

Требования к вводимым данным:
1. Длина заголовка --- не менее 3-ёх символов.
2. Длина содержания --- не менее 5-ти символов. TODO: как сделать здесь?

Если форма заполнена некорректно, то фронтенд не должен позволять пользователю нажать на кнопку создания.

При создании темы также создаётся первое сообщение в этой теме, автором которого является автор темы, с соответствующим содержанием. В остальном сообщение создаётся так, как описывается в разделе "Создание сообщения". При создании темы считается, что её время последнего обновления --- это время создания. Статус только что созданной темы --- активна.

## Создание сообщения в теме.

### Frontend.

TODO:

### Поведение.
Пользователь может создать сообщение в выбранной *активной* теме. Пользователь не может создать сообщение в *закрытой* теме.

Для создания сообщения нужно указать его содержание. Длина содержимого --- не менее 3-ёх символов.

Номер этого сообщения является следующим номером предыдущего сообщения. Время последнего редактирования сообщения считается неустановленным. На момент создания сообщение не имеет реакций или голосов кармы.

## Реакции.
### Общие ограничения.
Пользователь может оставить только одну реакцию с выбранным эмодзи под одним выбранным сообщением.

Например, под сообщением M пользователь U1 поставил один "👍" и один "👎". Пользователь U2 оставил под сообщением M реакцию "👎" и реакцию "🤡".
Кнопки реакций сообщения в текущий момент:
- 1 "👍"
- 2 "👎"
- 1 "🤡"

Пользователь U1 может убрать реакции "👍" и "👎", но не может оставить эти реакции ещё раз. Он также может оставить реакцию "🤡" под сообщением M (или любую другую, кроме уже оставленных им).

### Frontend.
Если пользователь оставлял реакции под сообщением, то соответствующие кнопки реакций выделены у него визуально. Пользователь может оставить реакцию, или нажав на кнопку "+" и выбрав эмодзи, или нажав по какой-либо кнопке реакций. Пользователь может убрать реакцию, нажав по выделенной кнопке реакций.

## Оставить реакцию на сообщение.
Любой пользователь может оставить реакцию на выбранном сообщении в любой теме (в том числе в закрытой).

## Убрать реакцию с сообщения.
Пользователь может убрать *ранее оставленные* реакции в любом сообщении в любой теме.
